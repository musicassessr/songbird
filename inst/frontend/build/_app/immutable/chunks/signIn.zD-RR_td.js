import{F as et,G as tt,I as H,v as y,J as nt,h as B,U as ot,K as M,L as K,g as v,d as k,e as $,a as D,M as Ze,N as le,A as L,P as Ie,Q as it,R as st,S as at,V as Re,p as C,W as rt,b as F,c as g,r as V,q as Y,X as Z}from"./Toaster.8GTgqi9N.js";function ct(){return et().getRandomValues(new Uint32Array(1))[0]}function dt(e){const t=e.words,n=e.sigBytes,o=[];for(let s=0;s<n;s++){const i=t[s>>>2]>>>24-s%4*8&255;o.push((i>>>4).toString(16)),o.push((i&15).toString(16))}return o.join("")}class ue{constructor(t,n){this.words=[];let o=t;o=this.words=o||[],n!==void 0?this.sigBytes=n:this.sigBytes=o.length*4}random(t){const n=[];for(let o=0;o<t;o+=4)n.push(ct());return new ue(n,t)}toString(){return dt(this)}}function lt(e){return Array.from(e,t=>String.fromCodePoint(t)).join("")}const z={convert(e,{urlSafe:t}={urlSafe:!1}){const n=typeof e=="string"?e:lt(e),o=tt()(n);return t?o.replace(/\+/g,"-").replace(/\//g,"_"):o}};function l(e,t){e!=null&&this.fromString(e,t)}function f(){return new l(null,null)}let T;const ut=0xdeadbeefcafe,Ne=(ut&16777215)===15715070;function Et(e,t,n,o,s,i){for(;--i>=0;){const a=t*this[e++]+n[o]+s;s=Math.floor(a/67108864),n[o++]=a&67108863}return s}function pt(e,t,n,o,s,i){const a=t&32767,r=t>>15;for(;--i>=0;){let c=this[e]&32767;const d=this[e++]>>15,E=r*c+d*a;c=a*c+((E&32767)<<15)+n[o]+(s&1073741823),s=(c>>>30)+(E>>>15)+r*d+(s>>>30),n[o++]=c&1073741823}return s}function ht(e,t,n,o,s,i){const a=t&16383,r=t>>14;for(;--i>=0;){let c=this[e]&16383;const d=this[e++]>>14,E=r*c+d*a;c=a*c+((E&16383)<<14)+n[o]+s,s=(c>>28)+(E>>14)+r*d,n[o++]=c&268435455}return s}const Se=typeof navigator<"u";Se&&Ne&&navigator.appName==="Microsoft Internet Explorer"?(l.prototype.am=pt,T=30):Se&&Ne&&navigator.appName!=="Netscape"?(l.prototype.am=Et,T=26):(l.prototype.am=ht,T=28);l.prototype.DB=T;l.prototype.DM=(1<<T)-1;l.prototype.DV=1<<T;const Ee=52;l.prototype.FV=Math.pow(2,Ee);l.prototype.F1=Ee-T;l.prototype.F2=2*T-Ee;const xt="0123456789abcdefghijklmnopqrstuvwxyz",J=new Array;let _,N;_=48;for(N=0;N<=9;++N)J[_++]=N;_=97;for(N=10;N<36;++N)J[_++]=N;_=65;for(N=10;N<36;++N)J[_++]=N;function ve(e){return xt.charAt(e)}function mt(e,t){var n=J[e.charCodeAt(t)];return n??-1}function ft(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function It(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function pe(e){var t=f();return t.fromInt(e),t}function Rt(e,t){let n;if(t===16)n=4;else if(t===8)n=3;else if(t===2)n=1;else if(t===32)n=5;else if(t===4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;let o=e.length,s=!1,i=0;for(;--o>=0;){const a=mt(e,o);if(a<0){e.charAt(o)==="-"&&(s=!0);continue}s=!1,i===0?this[this.t++]=a:i+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-i)-1)<<i,this[this.t++]=a>>this.DB-i):this[this.t-1]|=a<<i,i+=n,i>=this.DB&&(i-=this.DB)}this.clamp(),s&&l.ZERO.subTo(this,this)}function Nt(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function St(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e===8)t=3;else if(e===2)t=1;else if(e===32)t=5;else if(e===4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");let n=(1<<t)-1,o,s=!1,i="",a=this.t,r=this.DB-a*this.DB%t;if(a-- >0)for(r<this.DB&&(o=this[a]>>r)>0&&(s=!0,i=ve(o));a>=0;)r<t?(o=(this[a]&(1<<r)-1)<<t-r,o|=this[--a]>>(r+=this.DB-t)):(o=this[a]>>(r-=t)&n,r<=0&&(r+=this.DB,--a)),o>0&&(s=!0),s&&(i+=ve(o));return s?i:"0"}function vt(){var e=f();return l.ZERO.subTo(this,e),e}function yt(){return this.s<0?this.negate():this}function Tt(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;if(t=n-e.t,t!=0)return this.s<0?-t:t;for(;--n>=0;)if((t=this[n]-e[n])!=0)return t;return 0}function he(e){var t=1,n;return(n=e>>>16)!==0&&(e=n,t+=16),(n=e>>8)!==0&&(e=n,t+=8),(n=e>>4)!==0&&(e=n,t+=4),(n=e>>2)!==0&&(e=n,t+=2),(n=e>>1)!==0&&(e=n,t+=1),t}function Ft(){return this.t<=0?0:this.DB*(this.t-1)+he(this[this.t-1]^this.s&this.DM)}function gt(e,t){let n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function At(e,t){for(let n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function Ct(e,t){const n=e%this.DB,o=this.DB-n,s=(1<<o)-1;let i=Math.floor(e/this.DB),a=this.s<<n&this.DM,r;for(r=this.t-1;r>=0;--r)t[r+i+1]=this[r]>>o|a,a=(this[r]&s)<<n;for(r=i-1;r>=0;--r)t[r]=0;t[i]=a,t.t=this.t+i+1,t.s=this.s,t.clamp()}function Pt(e,t){t.s=this.s;const n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}const o=e%this.DB,s=this.DB-o,i=(1<<o)-1;t[0]=this[n]>>o;for(let a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&i)<<s,t[a-n]=this[a]>>o;o>0&&(t[this.t-n-1]|=(this.s&i)<<s),t.t=this.t-n,t.clamp()}function wt(e,t){let n=0,o=0,s=Math.min(e.t,this.t);for(;n<s;)o+=this[n]-e[n],t[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o-=e.s;n<this.t;)o+=this[n],t[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o-=e[n],t[n++]=o&this.DM,o>>=this.DB;o-=e.s}t.s=o<0?-1:0,o<-1?t[n++]=this.DV+o:o>0&&(t[n++]=o),t.t=n,t.clamp()}function Mt(e,t){const n=this.abs(),o=e.abs();let s=n.t;for(t.t=s+o.t;--s>=0;)t[s]=0;for(s=0;s<o.t;++s)t[s+n.t]=n.am(0,o[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!==e.s&&l.ZERO.subTo(t,t)}function Dt(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var o=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,o,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function _t(e,t,n){var o=e.abs();if(o.t<=0)return;var s=this.abs();if(s.t<o.t){t?.fromInt(0),n!=null&&this.copyTo(n);return}n===null&&(n=f());var i=f(),a=this.s,r=e.s,c=this.DB-he(o[o.t-1]);c>0?(o.lShiftTo(c,i),s.lShiftTo(c,n)):(o.copyTo(i),s.copyTo(n));const d=i.t,E=i[d-1];if(E===0)return;const u=E*(1<<this.F1)+(d>1?i[d-2]>>this.F2:0),p=this.FV/u,I=(1<<this.F1)/u,h=1<<this.F2;let x=n.t,R=x-d,m=t===null?f():t;for(i.dlShiftTo(R,m),n.compareTo(m)>=0&&(n[n.t++]=1,n.subTo(m,n)),l.ONE.dlShiftTo(d,m),m.subTo(i,i);i.t<d;)i[i.t++]=0;for(;--R>=0;){var U=n[--x]===E?this.DM:Math.floor(n[x]*p+(n[x-1]+h)*I);if((n[x]+=i.am(0,U,n,R,0,d))<U)for(i.dlShiftTo(R,m),n.subTo(m,n);n[x]<--U;)n.subTo(m,n)}t!==null&&(n.drShiftTo(d,t),a!==r&&l.ZERO.subTo(t,t)),n.t=d,n.clamp(),c>0&&n.rShiftTo(c,n),a<0&&l.ZERO.subTo(n,n)}function bt(e){var t=f();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(l.ZERO)>0&&e.subTo(t,t),t}function Ut(){if(this.t<1)return 0;var e=this[0];if(!(e&1))return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Bt(e){return this.compareTo(e)===0}function Lt(e,t){let n=0,o=0,s=Math.min(e.t,this.t);for(;n<s;)o+=this[n]+e[n],t[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o+=e.s;n<this.t;)o+=this[n],t[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o+=e[n],t[n++]=o&this.DM,o>>=this.DB;o+=e.s}t.s=o<0?-1:0,o>0?t[n++]=o:o<-1&&(t[n++]=this.DV+o),t.t=n,t.clamp()}function qt(e){var t=f();return this.addTo(e,t),t}function Ot(e){var t=f();return this.subTo(e,t),t}function Ht(e){var t=f();return this.multiplyTo(e,t),t}function zt(e){var t=f();return this.divRemTo(e,t,null),t}function b(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Wt(e){var t=f();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(l.ZERO)>0&&this.m.subTo(t,t),t}function Kt(e){var t=f();return e.copyTo(t),this.reduce(t),t}function kt(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,o=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e[n]+=this.m.am(0,o,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function $t(e,t){e.squareTo(t),this.reduce(t)}function Vt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}b.prototype.convert=Wt;b.prototype.revert=Kt;b.prototype.reduce=kt;b.prototype.mulTo=Vt;b.prototype.sqrTo=$t;function Yt(e,t,n){let o=e.bitLength(),s,i=pe(1),a=new b(t);if(o<=0)return i;o<18?s=1:o<48?s=3:o<144?s=4:o<768?s=5:s=6;let r=new Array,c=3,d=s-1,E=(1<<s)-1;if(r[1]=a.convert(this),s>1){const m=f();for(a.sqrTo(r[1],m);c<=E;)r[c]=f(),a.mulTo(m,r[c-2],r[c]),c+=2}let u=e.t-1,p,I=!0,h=f(),x;for(o=he(e[u])-1;u>=0;){for(o>=d?p=e[u]>>o-d&E:(p=(e[u]&(1<<o+1)-1)<<d-o,u>0&&(p|=e[u-1]>>this.DB+o-d)),c=s;!(p&1);)p>>=1,--c;if((o-=c)<0&&(o+=this.DB,--u),I)r[p].copyTo(i),I=!1;else{for(;c>1;)a.sqrTo(i,h),a.sqrTo(h,i),c-=2;c>0?a.sqrTo(i,h):(x=i,i=h,h=x),a.mulTo(h,r[p],i)}for(;u>=0&&!(e[u]&1<<o);)a.sqrTo(i,h),x=i,i=h,h=x,--o<0&&(o=this.DB-1,--u)}var R=a.revert(i);return n(null,R),R}l.prototype.copyTo=ft;l.prototype.fromInt=It;l.prototype.fromString=Rt;l.prototype.clamp=Nt;l.prototype.dlShiftTo=gt;l.prototype.drShiftTo=At;l.prototype.lShiftTo=Ct;l.prototype.rShiftTo=Pt;l.prototype.subTo=wt;l.prototype.multiplyTo=Mt;l.prototype.squareTo=Dt;l.prototype.divRemTo=_t;l.prototype.invDigit=Ut;l.prototype.addTo=Lt;l.prototype.toString=St;l.prototype.negate=vt;l.prototype.abs=yt;l.prototype.compareTo=Tt;l.prototype.bitLength=Ft;l.prototype.mod=bt;l.prototype.equals=Bt;l.prototype.add=qt;l.prototype.subtract=Ot;l.prototype.multiply=Ht;l.prototype.divide=zt;l.prototype.modPow=Yt;l.ZERO=pe(0);l.ONE=pe(1);const q={convert(e){return new TextEncoder().encode(e)}},Zt=async({a:e,g:t,k:n,x:o,B:s,N:i,U:a})=>new Promise((r,c)=>{t.modPow(o,i,(d,E)=>{if(d){c(d);return}s.subtract(n.multiply(E)).modPow(e.add(a.multiply(o)),i,(u,p)=>{if(u){c(u);return}r(p.mod(i))})})}),Jt="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",Je={},ae={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),Je[e]=t,ae[t]=e}const P=e=>{if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const o=e.slice(n,n+2).toLowerCase();if(o in ae)t[n/2]=ae[o];else throw new Error(`Cannot decode unrecognized sequence ${o} as hexadecimal`)}return t},xe=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Je[e[n]];return t},re=e=>{const t=new H.Sha256;t.update(e);const n=t.digestSync(),o=xe(n);return new Array(64-o.length).join("0")+o},O=e=>re(P(e)),Xt=/^[89a-f]/i,S=e=>{if(!(e instanceof l))throw new Error("Not a BigInteger");const t=e.compareTo(l.ZERO)<0;let n=e.abs().toString(16);if(n=n.length%2!==0?`0${n}`:n,n=Xt.test(n)?`00${n}`:n,t){const o=n.split("").map(i=>{const a=~parseInt(i,16)&15;return"0123456789ABCDEF".charAt(a)}).join("");n=new l(o,16).add(l.ONE).toString(16),n.toUpperCase().startsWith("FF8")&&(n=n.substring(2))}return n},jt=({A:e,B:t})=>{const n=new l(O(S(e)+S(t)),16);if(n.equals(l.ZERO))throw new Error("U cannot be zero.");return n},Qt=(e,t,n)=>{const o=new H.Sha256(t);o.update(e);const s=o.digestSync(),i=new H.Sha256(s);return i.update(n),i.digestSync().slice(0,16)},me=e=>{const t=new ue().random(e).toString();return P(t)},Gt=()=>z.convert(me(40));class en{constructor({userPoolName:t,a:n,g:o,A:s,N:i}){this.encoder=q,this.userPoolName=t,this.a=n,this.g=o,this.A=s,this.N=i,this.k=new l(O(`${S(i)}${S(o)}`),16)}getRandomPassword(){if(!this.randomPassword)throw new y({name:"EmptyBigIntegerRandomPassword",message:"random password is empty"});return this.randomPassword}getSaltToHashDevices(){if(!this.saltToHashDevices)throw new y({name:"EmptyBigIntegersaltToHashDevices",message:"saltToHashDevices is empty"});return this.saltToHashDevices}getVerifierDevices(){if(!this.verifierDevices)throw new y({name:"EmptyBigIntegerVerifierDevices",message:"verifyDevices is empty"});return this.verifierDevices}async generateHashDevice(t,n){this.randomPassword=Gt();const o=`${t}${n}:${this.randomPassword}`,s=re(o),i=xe(me(16));return this.saltToHashDevices=S(new l(i,16)),new Promise((a,r)=>{this.g.modPow(new l(O(this.saltToHashDevices+s),16),this.N,(c,d)=>{if(c){r(c);return}this.verifierDevices=S(d),a()})})}async getPasswordAuthenticationKey({username:t,password:n,serverBValue:o,salt:s}){if(o.mod(this.N).equals(l.ZERO))throw new Error("B cannot be zero.");const i=jt({A:this.A,B:o}),a=`${this.userPoolName}${t}:${n}`,r=re(a),c=new l(O(S(s)+r),16),d=await Zt({a:this.a,g:this.g,k:this.k,x:c,B:o,N:this.N,U:i}),E=this.encoder.convert("Caldera Derived Key"),u=this.encoder.convert(""),p=new Uint8Array(E.byteLength+u.byteLength);return p.set(E,0),p.set(u,E.byteLength),Qt(P(S(d)),P(S(i)),p)}}const tn=async({a:e,g:t,N:n})=>new Promise((o,s)=>{t.modPow(e,n,(i,a)=>{if(i){s(i);return}if(a.mod(n).equals(l.ZERO)){s(new Error("Illegal parameter. A mod N cannot be 0."));return}o(a)})}),X=async e=>{const t=new l(Jt,16),n=new l("2",16),o=nn(),s=await tn({a:o,g:n,N:t});return new en({userPoolName:e,a:o,g:n,A:s,N:t})},nn=()=>{const e=xe(me(128));return new l(e,16)},on=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],sn=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Xe=()=>{const e=new Date,t=sn[e.getUTCDay()],n=on[e.getUTCMonth()],o=e.getUTCDate();let s=e.getUTCHours();s<10&&(s=`0${s}`);let i=e.getUTCMinutes();i<10&&(i=`0${i}`);let a=e.getUTCSeconds();a<10&&(a=`0${a}`);const r=e.getUTCFullYear();return`${t} ${n} ${o} ${s}:${i}:${a} UTC ${r}`},je=({userPoolName:e,username:t,challengeParameters:n,dateNow:o,hkdf:s})=>{const i=q.convert(e),a=q.convert(t),r=an(n.SECRET_BLOCK),c=q.convert(o),d=new Uint8Array(i.byteLength+a.byteLength+r.byteLength+c.byteLength);d.set(i,0),d.set(a,i.byteLength),d.set(r,i.byteLength+a.byteLength),d.set(c,i.byteLength+a.byteLength+r.byteLength);const E=new H.Sha256(s);E.update(d);const u=E.digestSync();return z.convert(u)},an=e=>{const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),o=nt.convert(n),s=new Uint8Array(o.length);for(let i=0;i<o.length;++i)s[i]=o.charCodeAt(i);return s};var ye;(function(e){e.ConcurrentModificationException="ConcurrentModificationException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException"})(ye||(ye={}));var Te;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Te||(Te={}));var Fe;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UsernameExistsException="UsernameExistsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Fe||(Fe={}));var ge;(function(e){e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(ge||(ge={}));var Ae;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(Ae||(Ae={}));var Ce;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ce||(Ce={}));var Pe;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Pe||(Pe={}));var we;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(we||(we={}));var Me;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(Me||(Me={}));var De;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(De||(De={}));var _e;(function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"})(_e||(_e={}));var be;(function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidIdentityPoolConfigurationException="InvalidIdentityPoolConfigurationException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"})(be||(be={}));var Ue;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ue||(Ue={}));var Be;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException"})(Be||(Be={}));var W;(function(e){e.PasswordResetRequiredException="PasswordResetRequiredException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(W||(W={}));var Le;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(Le||(Le={}));var qe;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.MFAMethodNotFoundException="MFAMethodNotFoundException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(qe||(qe={}));var Oe;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Oe||(Oe={}));var He;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UsernameExistsException="UsernameExistsException"})(He||(He={}));var ze;(function(e){e.AliasExistsException="AliasExistsException",e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(ze||(ze={}));var We;(function(e){e.CodeMismatchException="CodeMismatchException",e.EnableSoftwareTokenMFAException="EnableSoftwareTokenMFAException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(We||(We={}));var Ke;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ke||(Ke={}));var ke;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(ke||(ke={}));var $e;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})($e||($e={}));const rn=(e,t)=>{switch(t.type){case"SET_SIGN_IN_SESSION":return{...e,signInSession:t.value};case"SET_SIGN_IN_STATE":return{...t.value};case"SET_CHALLENGE_NAME":return{...e,challengeName:t.value};case"SET_USERNAME":return{...e,username:t.value};case"SET_INITIAL_STATE":return Qe();default:return e}};function Qe(){return{username:void 0,challengeName:void 0,signInSession:void 0}}const cn=e=>{let t=e(Qe(),{type:"SET_INITIAL_STATE"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}},w=cn(rn);function j(e){w.dispatch({type:"SET_SIGN_IN_STATE",value:e})}function A(){w.dispatch({type:"SET_INITIAL_STATE"})}const Ve="userAttributes.";async function dn(e,t,n,o,s){const{userPoolClientId:i,userPoolId:a}=o,r={USERNAME:e,PASSWORD:t},c=await s.getDeviceMetadata(e);c&&c.deviceKey&&(r.DEVICE_KEY=c.deviceKey);const d=M({username:e,userPoolId:a,userPoolClientId:i}),E={AuthFlow:"USER_PASSWORD_AUTH",AuthParameters:r,ClientMetadata:n,ClientId:i,UserContextData:d},u=await K({region:v(a),userAgentValue:k($.SignIn)},E),p=u.ChallengeParameters?.USERNAME??u.ChallengeParameters?.USER_ID_FOR_SRP??e;return ne(p),u.ChallengeName==="DEVICE_SRP_AUTH"?fe({username:p,config:o,clientMetadata:n,session:u.Session,tokenOrchestrator:s}):u}async function ln(e,t,n,o,s){const{userPoolId:i,userPoolClientId:a}=o,r=i?.split("_")[1]||"",c=await X(r),d={USERNAME:e,SRP_A:c.A.toString(16)},E=M({username:e,userPoolId:i,userPoolClientId:a}),u={AuthFlow:"USER_SRP_AUTH",AuthParameters:d,ClientMetadata:n,ClientId:a,UserContextData:E},p=await K({region:v(i),userAgentValue:k($.SignIn)},u),{ChallengeParameters:I,Session:h}=p,x=I?.USERNAME??e;return ne(x),te(Ge,[t,I,n,h,c,o,s],x,s)}async function un(e,t,n,o){const{userPoolClientId:s,userPoolId:i}=n,a={USERNAME:e},r=await o.getDeviceMetadata(e);r&&r.deviceKey&&(a.DEVICE_KEY=r.deviceKey);const c=M({username:e,userPoolId:i,userPoolClientId:s}),d={AuthFlow:"CUSTOM_AUTH",AuthParameters:a,ClientMetadata:t,ClientId:s,UserContextData:c},E=await K({region:v(i),userAgentValue:k($.SignIn)},d),u=E.ChallengeParameters?.USERNAME??e;return ne(u),E.ChallengeName==="DEVICE_SRP_AUTH"?fe({username:u,config:n,clientMetadata:t,session:E.Session,tokenOrchestrator:o}):E}async function En(e,t,n,o,s){D(o);const{userPoolId:i,userPoolClientId:a}=o,r=i?.split("_")[1]||"",c=await X(r),d={USERNAME:e,SRP_A:c.A.toString(16),CHALLENGE_NAME:"SRP_A"},E=M({username:e,userPoolId:i,userPoolClientId:a}),u={AuthFlow:"CUSTOM_AUTH",AuthParameters:d,ClientMetadata:n,ClientId:a,UserContextData:E},{ChallengeParameters:p,Session:I}=await K({region:v(i),userAgentValue:k($.SignIn)},u),h=p?.USERNAME??e;return ne(h),te(Ge,[t,p,n,I,c,o,s],h,s)}async function fe({username:e,config:t,clientMetadata:n,session:o,tokenOrchestrator:s}){const i=t.userPoolId,a=t.userPoolClientId,r=await s?.getDeviceMetadata(e);Ze(r);const c=await X(r.deviceGroupKey),d={USERNAME:e,SRP_A:c.A.toString(16),DEVICE_KEY:r.deviceKey},E={ChallengeName:"DEVICE_SRP_AUTH",ClientId:a,ChallengeResponses:d,ClientMetadata:n,Session:o},{ChallengeParameters:u,Session:p}=await le({region:v(i)},E);return pn(e,u,n,p,c,t,s)}async function pn(e,t,n,o,s,{userPoolId:i,userPoolClientId:a},r){const c=await r?.getDeviceMetadata(e);Ze(c);const d=new l(t?.SRP_B,16),E=new l(t?.SALT,16),u=c.deviceKey,p=c.deviceGroupKey,I=await s.getPasswordAuthenticationKey({username:c.deviceKey,password:c.randomPassword,serverBValue:d,salt:E}),h=Xe(),x={USERNAME:t?.USERNAME??e,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:h,PASSWORD_CLAIM_SIGNATURE:je({username:u,userPoolName:p,challengeParameters:t,dateNow:h,hkdf:I}),DEVICE_KEY:u},R=M({username:e,userPoolId:i,userPoolClientId:a}),m={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:a,ChallengeResponses:x,Session:o,ClientMetadata:n,UserContextData:R};return le({region:v(i)},m)}async function Ge(e,t,n,o,s,i,a){const{userPoolId:r,userPoolClientId:c}=i,d=r?.split("_")[1]||"",E=new l(t?.SRP_B,16),u=new l(t?.SALT,16),p=t?.USER_ID_FOR_SRP;if(!p)throw new y({name:"EmptyUserIdForSRPException",message:"USER_ID_FOR_SRP was not found in challengeParameters"});const I=await s.getPasswordAuthenticationKey({username:p,password:e,serverBValue:E,salt:u}),h=Xe(),x={USERNAME:p,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:h,PASSWORD_CLAIM_SIGNATURE:je({username:p,userPoolName:d,challengeParameters:t,dateNow:h,hkdf:I})},R=await a.getDeviceMetadata(p);R&&R.deviceKey&&(x.DEVICE_KEY=R.deviceKey);const m=M({username:p,userPoolId:r,userPoolClientId:c}),U={ChallengeName:"PASSWORD_VERIFIER",ChallengeResponses:x,ClientMetadata:n,Session:o,ClientId:c,UserContextData:m},se=await le({region:v(r)},U);return se.ChallengeName==="DEVICE_SRP_AUTH"?fe({username:p,config:i,clientMetadata:n,session:se.Session,tokenOrchestrator:a}):se}async function Q(e){const{challengeName:t,challengeParameters:n}=e,o=L.getConfig().Auth?.Cognito;switch(D(o),t){case"CUSTOM_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE",additionalInfo:n}};case"MFA_SETUP":const{signInSession:s,username:i}=w.getState();if(!fn(n,"TOTP"))throw new y({name:Ie.SignInException,message:`Cannot initiate MFA setup from available types: ${ce(de(n.MFAS_CAN_SETUP))}`});const{Session:a,SecretCode:r}=await it({region:v(o.userPoolId)},{Session:s});return w.dispatch({type:"SET_SIGN_IN_SESSION",value:a}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:hn(r,i)}};case"NEW_PASSWORD_REQUIRED":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:xn(n.requiredAttributes)}};case"SELECT_MFA_TYPE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SELECTION",allowedMFATypes:ce(de(n.MFAS_CAN_CHOOSE))}};case"SMS_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_SMS_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"SOFTWARE_TOKEN_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}}}throw new y({name:Ie.SignInException,message:`An error occurred during the sign in process. ${t} challengeName returned by the underlying service was not addressed.`})}function hn(e,t){return{sharedSecret:e,getSetupUri:(n,o)=>{const s=`otpauth://totp/${n}:${o??t}?secret=${e}&issuer=${n}`;return new st(s)}}}function G(e){if(e===W.PasswordResetRequiredException)return{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}};if(e===W.UserNotConfirmedException)return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_UP"}}}function xn(e){return e?JSON.parse(e).map(n=>n.includes(Ve)?n.replace(Ve,""):n):[]}function mn(e){if(e==="SMS_MFA")return"SMS";if(e==="SOFTWARE_TOKEN_MFA")return"TOTP"}function ce(e){if(e)return e.map(mn).filter(Boolean)}function de(e){return e?JSON.parse(e):[]}function fn(e,t){const{MFAS_CAN_SETUP:n}=e,o=ce(de(n));return o?o.includes(t):!1}async function In(){let e;try{e=await B()}catch{}if(e&&e.userId&&e.username)throw new y({name:ot,message:"There is already a signed in user.",recoverySuggestion:"Call signOut before calling signIn again."})}async function ee(e,t,n){if(!t)return;const o=e.split("_")[1]||"",s=await X(o),i=t?.DeviceKey,a=t?.DeviceGroupKey;try{await s.generateHashDevice(a??"",i??"")}catch{return}const r={Salt:z.convert(P(s.getSaltToHashDevices())),PasswordVerifier:z.convert(P(s.getVerifierDevices()))},c=s.getRandomPassword();try{return await at({region:v(e)},{AccessToken:n,DeviceKey:t?.DeviceKey,DeviceSecretVerifierConfig:r}),{deviceKey:i,deviceGroupKey:a,randomPassword:c}}catch{return}}async function te(e,t,n,o){try{return await e(...t)}catch(s){if(s instanceof y&&s.name==="ResourceNotFoundException"&&s.message.includes("Device does not exist."))return await o.clearDeviceMetadata(n),await e(...t);throw s}}function ne(e){const{dispatch:t}=w;t({type:"SET_USERNAME",value:e})}function oe(e){return w.getState().username??e}async function ie(e){if(e.AccessToken){const t=Re(e.AccessToken),n=(t.payload.iat||0)*1e3,o=new Date().getTime(),s=n>0?n-o:0;let i,a,r;e.RefreshToken&&(a=e.RefreshToken),e.IdToken&&(i=Re(e.IdToken)),e?.NewDeviceMetadata&&(r=e.NewDeviceMetadata);const c={accessToken:t,idToken:i,refreshToken:a,clockDrift:s,deviceMetadata:r,username:e.username};e?.signInDetails&&(c.signInDetails=e.signInDetails),await C.setTokens({tokens:c})}else throw new rt({message:"Invalid tokens",name:"InvalidTokens",recoverySuggestion:"Check Cognito UserPool settings"})}async function Rn(e){const t=L.getConfig().Auth?.Cognito;D(t);const{username:n,password:o,options:s}=e,i={loginId:n,authFlowType:"CUSTOM_WITHOUT_SRP"},a=s?.clientMetadata;F(!!n,g.EmptySignInUsername),F(!o,g.CustomAuthSignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:d,Session:E}=await te(un,[n,a,t,C],n,C),u=oe(n);return j({signInSession:E,username:u,challengeName:r,signInDetails:i}),d?(A(),await ie({username:u,...d,NewDeviceMetadata:await ee(t.userPoolId,d.NewDeviceMetadata,d.AccessToken),signInDetails:i}),Y.dispatch("auth",{event:"signedIn",data:await B()},"Auth",V),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:r,challengeParameters:c})}catch(r){A(),Z(r);const c=G(r.name);if(c)return c;throw r}}async function Nn(e){const{username:t,password:n,options:o}=e,s={loginId:t,authFlowType:"CUSTOM_WITH_SRP"},i=L.getConfig().Auth?.Cognito;D(i);const a=o?.clientMetadata;F(!!t,g.EmptySignInUsername),F(!!n,g.EmptySignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:d,Session:E}=await En(t,n,a,i,C),u=oe(t);return j({signInSession:E,username:u,challengeName:r,signInDetails:s}),d?(await ie({username:u,...d,NewDeviceMetadata:await ee(i.userPoolId,d.NewDeviceMetadata,d.AccessToken),signInDetails:s}),A(),Y.dispatch("auth",{event:"signedIn",data:await B()},"Auth",V),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:r,challengeParameters:c})}catch(r){A(),Z(r);const c=G(r.name);if(c)return c;throw r}}async function Ye(e){const{username:t,password:n}=e,o=L.getConfig().Auth?.Cognito,s={loginId:t,authFlowType:"USER_SRP_AUTH"};D(o);const i=e.options?.clientMetadata;F(!!t,g.EmptySignInUsername),F(!!n,g.EmptySignInPassword);try{const{ChallengeName:a,ChallengeParameters:r,AuthenticationResult:c,Session:d}=await ln(t,n,i,o,C),E=oe(t);return j({signInSession:d,username:E,challengeName:a,signInDetails:s}),c?(A(),await ie({username:E,...c,NewDeviceMetadata:await ee(o.userPoolId,c.NewDeviceMetadata,c.AccessToken),signInDetails:s}),Y.dispatch("auth",{event:"signedIn",data:await B()},"Auth",V),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:a,challengeParameters:r})}catch(a){A(),Z(a);const r=G(a.name);if(r)return r;throw a}}async function Sn(e){const{username:t,password:n,options:o}=e,s=L.getConfig().Auth?.Cognito,i={loginId:t,authFlowType:"USER_PASSWORD_AUTH"};D(s);const a=o?.clientMetadata;F(!!t,g.EmptySignInUsername),F(!!n,g.EmptySignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:d,Session:E}=await te(dn,[t,n,a,s,C],t,C),u=oe(t);return j({signInSession:E,username:u,challengeName:r,signInDetails:i}),d?(await ie({...d,username:u,NewDeviceMetadata:await ee(s.userPoolId,d.NewDeviceMetadata,d.AccessToken),signInDetails:i}),A(),Y.dispatch("auth",{event:"signedIn",data:await B()},"Auth",V),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:r,challengeParameters:c})}catch(r){A(),Z(r);const c=G(r.name);if(c)return c;throw r}}async function yn(e){const t=e.options?.authFlowType;switch(await In(),t){case"USER_SRP_AUTH":return Ye(e);case"USER_PASSWORD_AUTH":return Sn(e);case"CUSTOM_WITHOUT_SRP":return Rn(e);case"CUSTOM_WITH_SRP":return Nn(e);default:return Ye(e)}}export{yn as s};
